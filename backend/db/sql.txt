# Средний рейтинг по районам ТОП 3
SELECT district, round(sum(rating_all)/count(row_num), 2) as f1
FROM (
SELECT *,
ROW_NUMBER() OVER (PARTITION BY district ORDER BY rating_all DESC) AS row_num
FROM avito WHERE record_status = "2"
) AS ranked
WHERE row_num <= 3 GROUP BY district ORDER BY f1 DESC;
